# NYC Eats — nginx config template
# Generated by: make nginx.conf
# Values come from .env — see .env.example

server {
    listen 80;
    server_name {{SITE_DOMAIN}};

    root {{VPS_PATH}};
    index index.html;

    # venues.js is the biggest asset — cache aggressively since
    # the build regenerates it with new content
    location = /venues.js {
        expires 1d;
        add_header Cache-Control "public, immutable";
        gzip_static on;
    }

    location ~* \.(css|js|png|ico|svg)$ {
        expires 7d;
        add_header Cache-Control "public";
    }

    location = /index.html {
        add_header Cache-Control "no-cache";
    }

    # Hit counter API (tiny Python service on port 8091)
    location /api/ {
        proxy_pass http://127.0.0.1:8091;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        try_files $uri $uri/ =404;
    }

    # Security basics
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "DENY" always;

    access_log /var/log/nginx/nyc-eats.access.log;
    error_log  /var/log/nginx/nyc-eats.error.log;
}
